# 要件定義書：meeting-record（AI議事録管理アプリ）

本要件定義書は、GitHub Issue（1〜11）および CLAUDE.md に基づいて作成される。
記載のない仕様は実装しない。

技術的な実装ルールや開発ワークフローについては、[CLAUDE.md](./CLAUDE.md) を参照のこと。

---

## 1. プロジェクト概要

### 1.1 プロジェクト名
meeting-record

### 1.2 概要
meeting-record は、会議の文字起こしテキスト（raw_text）を入力することで、
生成AI（Gemini）を用いて **要約・アクション抽出・QA** を行い、
会議を「記録」で終わらせず **次の行動につなげる** ことを目的としたAI議事録管理アプリである。

本アプリは **ログインなしで即AI体験が可能** であり、
保存・共有・検索といった実務機能はログイン後に提供する。

---

## 2. アプリのゴール（WHO / WHAT / HOW）

### 2.1 WHO（誰のためのアプリか）
- チーム・部門で定例会議や進捗会議を頻繁に行う会社員
- 会議後のタスク整理や意思決定の共有に課題を感じている利用者

### 2.2 WHAT（何を実現するか）
- 会議で決まった **次のアクション** を明確にする
- 誰が・何を・いつまでにやるのかを曖昧にしない
- 会議の成果を、あとから見返し・活用できる状態にする

### 2.3 HOW（どのように実現するか）
- 生成AI（Gemini）を用いて
  - 会議内容を要約
  - アクションプランを構造化抽出
  - 議事録内容に対するQAを提供
- raw_text を正データとして保持し、AI出力は派生データとして扱う
- ログインなしでAI体験、ログイン後に保存・共有という二段構えのUXを採用

---

## 3. ターゲットユーザー詳細

### 3.1 主ターゲット
- 社内の定例会議・進捗会議に参加するメンバー
- 会議後に「結局何が決まったのか分からない」状態を避けたい人

### 3.2 利用シーン
- 会議直後に議事録を整理したい場面
- 欠席者や後追いメンバーが内容を確認する場面
- 数週間後に「この会議で何が決まったか」を確認したい場面

---

## 4. 主要機能

### 4.1 MVP機能（必須）

#### 4.1.1 議事録入力
- 会議の文字起こしテキスト（raw_text）を入力
- 最大30,000文字
- raw_text は正データとして保持し、AIで改変しない

#### 4.1.2 AI要約
- raw_text を入力として要約を生成
- **出力品質要件**:
  - 読みやすさ優先（箇条書き主体）
  - raw_textに存在する範囲で以下を含める:
    - 決定事項（何が決まったか）
    - 主要論点（何が議論されたか）
    - 次アクションの方向性（担当者・期限はアクション抽出で確定）
- 創作禁止（raw_textにない内容は出さない）
- ゲスト：表示のみ
- ログイン後：保存可能

#### 4.1.3 AIアクション抽出
- raw_text からタスクを構造化抽出
- **出力は必ずJSONとしてパース可能であること（必須）**
- **JSON要件**:
  - JSON配列形式
  - 必須キー: task_content, assignee_name, due_at, note, evidence
  - キー欠落・パース不能は失敗扱い
- evidence（根拠引用）必須
- 不明な担当者・期限は null
- ゲスト：表示のみ
- ログイン後：保存可能

#### 4.1.4 AI QA
- 議事録内容に対する質問応答
- 根拠必須
- 根拠がない場合は必ず「記載がありません」と返す
- ゲスト：表示のみ

#### 4.1.5 保存・共有
- ログイン後のみ議事録を保存
- 同一部門内で閲覧可能
- 編集・削除は作成者のみ（RLS）

#### 4.1.6 検索
- ログイン後のみ
- title / meeting_date / raw_text による検索
- RLS前提

#### 4.1.7 音声アップロード
- ログイン後のみ
- MIME：audio/mp4（m4a）
- サイズ上限：20MB

---

### 4.2 将来機能（思想レベル）

- Slack等のチャットサービス連携
  - 議事録が保存された時点で、自動通知を送信
  - 通知内容：会議名、要約、主要アクション
- 自動文字起こし（音声→テキスト）
  - MVPでは実装しない

※ 本要件定義では **将来機能の実装は行わない**。

---

## 5. UI / UX方針

### 5.1 基本方針
- ログインなしでもAI体験ができることを最優先
- AIは **自動実行しない**（必ずボタン操作）
- 保存操作時のみログイン誘導を行い、二度手間を避ける

### 5.2 ゲストトップ画面（Issue 6）

#### 初期状態
- 画面初期表示時点で、raw_text欄に **サンプル議事録（開発進捗定例）** が入っている
- サンプルであることが分かる表示を入れる

#### 操作要素
- **サンプル操作ボタン**:
  - 「サンプル議事録を挿入」ボタン
  - 「クリア」ボタン
- **AI実行ボタン**（明示的に配置）:
  - 「要約を生成」
  - 「アクションを抽出」
  - 「質問する（QA）」
- **保存ボタン**: 未ログイン時はログイン誘導

#### 誤解防止の文言（必須）
初見ユーザーが誤解しないよう、以下の文言を必ず表示する:
- 「AI機能はボタンを押すと実行されます（自動では実行されません）」
- 「このアプリは入力テキスト（raw_text）を元にAI処理します」
- 「保存・共有・検索・音声アップロードはログイン後に利用できます」
- 「AIは入力テキストにない内容を創作しません」

### 5.3 ログイン後画面
- 議事録一覧 / 詳細 / 保存 / 検索 / 音声アップロード

---

## 6. データ設計の基本方針

### 6.1 正データと派生データ
- **正データ**：minutes.raw_text（AI で改変禁止）
- **派生データ**：summary / action_items / QA 結果（再生成前提）

### 6.2 設計ゴール
- 型・制約・用途を明示し、AI の推測余地を排除

### 6.3 主要テーブル
- profiles（ユーザー、部門管理）
- minutes（議事録本体）
- action_items（アクションプラン）
- audio_files（音声ファイルメタデータ）
- ai_jobs（AI処理ジョブ管理）

詳細なスキーマは [CLAUDE.md](./CLAUDE.md) の「データモデル（Issue 3）」を参照。

### 6.4 profiles自動作成

- ログイン直後に `profiles` レコードが存在しなければ自動作成
- `profiles.id = auth.uid()` に一致させる
- `department_id` を必ずセット（「1人=1部門」の原則に従う）
- MVP想定では department_id は固定値または環境変数で設定
- UIでの部門選択機能はスコープ外

---

## 7. 非機能要件

### 7.1 セキュリティ・権限制御
- Row Level Security（RLS）による部門境界の厳守
- 閲覧：同一部門のみ
- 編集・削除：作成者のみ
- Storage（音声）も部門境界を守る

### 7.2 コスト・乱用対策
- guest_id cookie（初回アクセス時に発行） + IP によるレート制限
- 入力文字数制限（raw_text: 30,000文字、question: 800文字）
- 連打防止（10〜30秒以内の連続実行を拒否）
- 同一入力キャッシュ必須（TTL: 6〜24時間）

### 7.3 AI利用における制約
- Gemini API は必ずサーバー側で実行
- API キーはクライアントに露出させない
- エラー時は内部情報を返さない

#### エラーハンドリング（必須）
- **JSONパースエラー（アクション抽出）**: エラー表示し、再生成を促す（内部情報は見せない）
- **レート制限超過**: 「利用回数の上限に達しました。しばらく経ってから再度お試しください」等の制限超過メッセージを表示
- **入力文字数超過**: 文字数上限の案内を表示（「入力は30,000文字までです」等）
- **Gemini API失敗**: ユーザーには「エラーが発生しました。しばらく経ってから再度お試しください」などの汎用メッセージを表示

---

## 8. 開発ロードマップ

### フェーズ1（MVP）
- raw_text入力
- AI要約 / アクション抽出 / QA（ゲスト体験）
- ログイン機能
- 議事録保存
- 部門共有（RLS）

### フェーズ2（品質向上）
- 検索機能
- 音声アップロード
- UI改善

### フェーズ3（将来構想）
- Slack等への自動通知連携
- 自動文字起こし

---

## 9. 成功基準

### 9.1 実務的成功
- 採用担当が「実務で使えるアプリ」と判断できる
- 会議後のアクションが明確になる体験を提供できている

### 9.2 技術的成功
- データ設計（raw_text正・派生再生成）が一貫している
- 権限制御・コスト対策・AIの使いどころが明確

### 9.3 総合評価
- 「AIを使っている」ではなく
  **「業務課題を理解した上でAIを使っている」**
  アプリとして評価される

---

## 10. GitHub Issue対応表

| Issue | 内容 | 詳細参照先 |
|-------|------|-----------|
| 1 | 認証 | CLAUDE.md「認証（Issue 1）」 |
| 2 | RLS | CLAUDE.md「RLS（Issue 2）」 |
| 3 | データモデル | CLAUDE.md「データモデル（Issue 3）」 |
| 4 | 音声アップロード | CLAUDE.md「音声アップロード（Issue 4）」 |
| 5 | raw_text登録 | CLAUDE.md「raw_text登録（Issue 5）」 |
| 6 | UI | CLAUDE.md「UI（Issue 6）」 |
| 7 | 要約 | CLAUDE.md「Issue 7：要約」 |
| 8 | アクション抽出 | CLAUDE.md「Issue 8：アクション抽出」 |
| 9 | QA | CLAUDE.md「Issue 9：QA」 |
| 10 | 検索 | CLAUDE.md「検索（Issue 10）」 |
| 11 | README | CLAUDE.md「README（Issue 11）」 |
